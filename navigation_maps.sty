\ProvidesPackage{navigation_maps}

\RequirePackage{pgf, pgfkeys, tikz}

% Save min and max values for x and y direction
\pgfkeys{
    /xMin/.is family,
    /xMin/deg/.initial=0,
    /xMin/min/.initial=0,
}

\pgfkeys{
    /xMax/.is family,
    /xMax/deg/.initial=0,
    /xMax/min/.initial=0,
}

\pgfkeys{
    /yMin/.is family,
    /yMin/deg/.initial=0,
    /yMin/min/.initial=0,
}

\pgfkeys{
    /yMax/.is family,
    /yMax/deg/.initial=0,
    /yMax/min/.initial=0,
}


% Arguments: x/y-Axis, axis diff, axis min, axis max
\newcommand{\navAxisSetup}[4]{
    \gdef\navIsXAxis{#1} % 0: x-Axis, other y-Axis
    \gdef\navAxisDiff{#2}
    \gdef\navAxisMin{#3}
    \gdef\navAxisMax{#4}

    % Check 5 step increments
    \pgfmathsetmacro{\minMinInc}{int(\navAxisMin / 25)}
    \pgfmathsetmacro{\minMaxInc}{int(\navAxisMax / 25)}
    \pgfmathsetmacro{\minDiff}{\minMaxInc - \minMinInc}

    \foreach \i in {0, ..., \navAxisDiff}{
        \pgfmathparse{\i}
        \ifnum \pgfmathresult>0

            % Check x/y-Axis
            \pgfmathparse{\navIsXAxis}
            \ifnum \pgfmathresult=0
                \draw (\i - 1, -\navBarSize) rectangle (\i, 0);
            \else
                \draw (-\navBarSize, \i - 1) rectangle (0, \i);
            \fi
        \fi

        \pgfmathsetmacro{\Xstart}{\i + \navAxisMin}
        \pgfmathsetmacro{\currDeg}{int((\i + \navAxisMin) / (60 * 5))}


        % Check for degrees
        \pgfmathsetmacro{\countA}{int(\Xstart / (5 * 60))}
        \pgfmathsetmacro{\countB}{int(5 * 60 * \countA)}
        \pgfmathsetmacro{\DegreeOverlap}{\Xstart - \countB}

        % Show degrees
        \pgfmathparse{int(\DegreeOverlap)}
        \ifnum \pgfmathresult=0
            % Check x/y-Axis
            \pgfmathparse{\navIsXAxis}
            \ifnum \pgfmathresult=0
                \draw[blue] (\i, 0) -- (\i, -\navNumberOffset) node[anchor=north]{\currDeg $^{\circ}$};
            \else
                \draw[blue] (0, \i) -- (-\navNumberOffset, \i) node[anchor=east]{\currDeg $^{\circ}$};
            \fi


        \else
            % Check for minutes
            % Create a mark for every minute
            \pgfmathsetmacro{\minStepSize}{5}
            \navShowMin{}

            \pgfmathparse{int(\minDiff)}
            \ifnum \pgfmathresult>0
                \pgfmathsetmacro{\minStepSize}{5 * 5}
            \fi

            % Show minutes (numbers)
            \navShowMin{\currMin '}
        \fi
    }

    \pgfmathsetmacro{\xCenter}{int(\navAxisDiff / 2)}

    % Set at least one degree value
    \pgfmathsetmacro{\countA}{int(\navAxisMin / (5 * 60))}
    \pgfmathsetmacro{\countB}{int(\navAxisMax / (5 * 60))}
    \pgfmathsetmacro{\DegreeTotalOverlap}{int(\countB - \countA)}

    \pgfmathparse{int(\DegreeTotalOverlap)}
    \ifnum \pgfmathresult=0
        \pgfmathsetmacro{\currDeg}{int(\navAxisMin / (60 * 5))}

        % Check x/y-Axis
        \pgfmathparse{\navIsXAxis}
        \ifnum \pgfmathresult=0
            \draw[black] (\xCenter, -5) node[anchor=north]{\currDeg $^{\circ}$};
        \else
            \draw[black] (-5, \xCenter) node[anchor=east]{\currDeg $^{\circ}$};
        \fi
    \fi
}

\newcommand{\navShowMin}[1]{
    \pgfmathsetmacro{\countOverlapA}{int(\Xstart / \minStepSize)}
    \pgfmathsetmacro{\countOverlapB}{int(\countOverlapA * \minStepSize)}
    \pgfmathsetmacro{\MinOverlap}{\Xstart - \countOverlapB}

    \pgfmathparse{int(\MinOverlap)}
    \ifnum \pgfmathresult=0
        \pgfmathsetmacro{\currMin}{int(int((\i + \navAxisMin) / 5) - (\currDeg * 60))}

        % Check x/y-Axis
        \pgfmathparse{\navIsXAxis}
        \ifnum \pgfmathresult=0
            \draw[black] (\i, 0) -- (\i, -2) node[anchor=north]{#1};
        \else
            \draw[black] (0, \i) -- (-2, \i) node[anchor=east]{#1};
        \fi
    \fi
}

% Arguments: xMin, xMax, yMin, yMax, figure scaling
\newenvironment{nav_map}[5]
% Run at the start
{
    \pgfqkeys{/xMin}{#1}
    \pgfqkeys{/xMax}{#2}
    \pgfqkeys{/yMin}{#3}
    \pgfqkeys{/yMax}{#4}

    \newcommand{\navBarSize}{0.5}
    \newcommand{\navNumberOffset}{4}

    \gdef\navScaling{#5}

    \begin{tikzpicture}[scale=\navScaling]
        % 1 Degree is divided into 60 minutes
        % 1 minute is divided into 5 blocks

        \pgfmathsetmacro{\xMin}{(\pgfkeysvalueof{/xMin/deg} * 60 * 5) + (\pgfkeysvalueof{/xMin/min} * 5)}
        \pgfmathsetmacro{\xMax}{(\pgfkeysvalueof{/xMax/deg} * 60 * 5) + (\pgfkeysvalueof{/xMax/min} * 5)}
        \pgfmathsetmacro{\xDiff}{\xMax - \xMin}

        \pgfmathsetmacro{\yMin}{(\pgfkeysvalueof{/yMin/deg} * 60 * 5) + (\pgfkeysvalueof{/yMin/min} * 5)}
        \pgfmathsetmacro{\yMax}{(\pgfkeysvalueof{/yMax/deg} * 60 * 5) + (\pgfkeysvalueof{/yMax/min} * 5)}
        \pgfmathsetmacro{\yDiff}{\yMax - \yMin}

        % Draw bounding rectangle
        \draw (0, 0) rectangle (\xDiff, \yDiff);


        % -----------------------------------------
        % x Axis
        \navAxisSetup{0}{\xDiff}{\xMin}{\xMax}

        % -----------------------------------------
        % y Axis
        \navAxisSetup{1}{\yDiff}{\yMin}{\yMax}
}
% Run at the end
{
    \end{tikzpicture}
}

